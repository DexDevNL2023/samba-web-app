<div class="d-flex justify-content-center">
  <div class="col-md-8">
    <h2 class="mt-3">
      Paramètres de l'utilisateur pour <strong>{{ settingsForm.value.login }}</strong>
    </h2>

    <p-messages *ngIf="success" severity="success" [text]="'Profil mis à jour'"></p-messages>

    <form *ngIf="settingsForm.value.login" name="form" (ngSubmit)="save()" [formGroup]="settingsForm" novalidate>
      <div class="mb-3">
        <label class="form-label" for="imageUrl">Photo de profil</label>
        <p-fileUpload
          name="imageUrl"
          chooseLabel="Choisir"
          uploadLabel="Télécharger"
          cancelLabel="Annuler"
          accept="image/*"
          (onSelect)="onFileSelected('imageUrl', $event)"
          [showUploadButton]="false"
          [showCancelButton]="true"
          [auto]="true"
        ></p-fileUpload>
        <div *ngIf="imageUrlPreview" class="mt-2">
          <img [src]="imageUrlPreview" alt="Preview" style="max-width: 100px; max-height: 100px;" />
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label" for="firstName">Prénoms</label>
        <input
          type="text"
          class="form-control"
          id="firstName"
          name="firstName"
          placeholder="Prénoms"
          formControlName="firstName"
          data-cy="firstname"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="lastName">Nom de famille</label>
        <input
          type="text"
          class="form-control"
          id="lastName"
          name="lastName"
          placeholder="Nom de famille"
          formControlName="lastName"
          data-cy="lastname"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="email">Email</label>
        <input
          type="email"
          class="form-control"
          id="email"
          name="email"
          placeholder="Email"
          formControlName="email"
          data-cy="email"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="numNiu">NIU</label>
        <input
          type="text"
          class="form-control"
          id="numNiu"
          name="numNiu"
          formControlName="numNiu"
        />
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label" for="dateNaissance">Date de naissance</label>
        <p-calendar
          id="dateNaissance"
          name="dateNaissance"
          formControlName="dateNaissance"
          [showIcon]="true"
          inputId="icon"
          dateFormat="dd/mm/yy"
          [monthNavigator]="true"
          [yearNavigator]="true"
          yearRange="1900:{{ currentYear }}"
          placeholder="Sélectionnez une date"
        ></p-calendar>
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label" for="numCni">CNI</label>
        <input
          type="text"
          class="form-control"
          id="numCni"
          name="numCni"
          formControlName="numCni"
        />
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label" for="sexe">Genre</label>
        <p-dropdown
          [options]="genders"
          placeholder="Genre"
          formControlName="sexe"
        ></p-dropdown>
      </div>

      <div class="mb-3">
        <label class="form-label" for="telephone">Téléphone</label>
        <input
          type="text"
          class="form-control"
          id="telephone"
          name="telephone"
          formControlName="telephone"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="addresse">Adresse</label>
        <input
          type="text"
          class="form-control"
          id="addresse"
          name="addresse"
          formControlName="addresse"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="ville">Ville</label>
        <input
          type="text"
          class="form-control"
          id="ville"
          name="ville"
          formControlName="ville"
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="pays">Pays</label>
        <input
          type="text"
          class="form-control"
          id="pays"
          name="pays"
          formControlName="pays"
        />
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label" for="signature">Signature</label>
        <p-fileUpload
          name="signature"
          chooseLabel="Choisir"
          uploadLabel="Télécharger"
          cancelLabel="Annuler"
          accept="image/*"
          (onSelect)="onFileSelected('signature', $event)"
          [showUploadButton]="true"
          [showCancelButton]="true"
          [auto]="true"
        ></p-fileUpload>
        <div *ngIf="signatureUrlPreview" class="mt-2">
          <img [src]="signatureUrlPreview" alt="Preview" style="max-width: 100px; max-height: 100px;" />
        </div>
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label">Dossiers Médicaux</label>
        <!-- Display medical records here -->
      </div>

      <div *ngIf="hasAuthority(['ROLE_CLIENT'])" class="mb-3">
        <label class="form-label">Souscriptions</label>
        <!-- Display subscriptions here -->
      </div>

      <button type="submit" class="btn btn-primary" [disabled]="!settingsForm.valid">Sauvegarder</button>
    </form>
  </div>
</div>
